---
- hosts: servers
  remote_user: root
  tasks:
  - name: install docker
    apt: name=docker.io state=latest
  - name: install zfs utilities
    apt: name=zfsutils-linux state=latest
  - name: prepare zpool
    shell: fallocate -l 3G /root/zfs.disk && zpool create -f chq /root/zfs.disk
    args:
      executable: /bin/bash
  - name: create alias
    shell: docker login -e="." -u="clusterhq_prod+pull_fli" -p="99E32PIAJQB83WB3YWBD0XW2X6EJMC7CRK1ZVVNQRN27JLLMF2DPJ035SG4O1QKV" quay.io
    args:
      executable: /bin/bash
  - name: create alias for logged in root users
    shell: echo "alias fli='docker run --rm --privileged -v /chq/:/chq/:shared -v /root:/root -v /lib/modules:/lib/modules quay.io/clusterhq_prod/fli:638f390c51781344a65f4318363cf57e15cabe33'" >> /root/.bashrc
    args:
      executable: /bin/bash
  - name: place fli binary
    shell: docker create --name fli-bin quay.io/clusterhq_prod/fli:638f390c51781344a65f4318363cf57e15cabe33 && docker cp fli-bin:/opt/clusterhq/bin/fli /usr/bin/ && chmod +x /usr/bin/fli && docker rm -f fli-bin 
    args:
      executable: /bin/bash
